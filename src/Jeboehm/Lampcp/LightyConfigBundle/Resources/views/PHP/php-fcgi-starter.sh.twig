#!/bin/sh
##
#
# Generated by
#
# LampCP
# https://github.com/jeboehm/LampCP
#
# Licensed under the GPL Version 2 license
# http://www.gnu.org/licenses/gpl-2.0.txt
#
##

SPAWNFCGI="/usr/bin/spawn-fcgi"
FCGIPROGRAM="/usr/bin/php-cgi"
FCGISOCKET="{{ domain.path }}/tmp/php.socket"
PHPRC="{{ domain.path }}/conf/"

## number of PHP childs to spawn in addition to the default. Minimum of 2.
## Actual childs = PHP_FCGI_CHILDREN + 1
PHP_FCGI_CHILDREN=1

## number of request server by a single php-process until is will be restarted
PHP_FCGI_MAX_REQUESTS=1000

## IP adresses where PHP should access server connections from
FCGI_WEB_SERVER_ADDRS="127.0.0.1"

ALLOWED_ENV="PATH USER"
USERID="{{ domain.user.name }}"
GROUPID="{{ domain.user.groupname }}"

##############################################################################
##############################################################################

if test x$PHP_FCGI_CHILDREN = x; then
    PHP_FCGI_CHILDREN=1
fi

export PHP_FCGI_MAX_REQUESTS
export FCGI_WEB_SERVER_ADDRS
export PHPRC

ALLOWED_ENV="$ALLOWED_ENV PHP_FCGI_MAX_REQUESTS FCGI_WEB_SERVER_ADDRS PHPRC"

E=

for i in $ALLOWED_ENV; do
    E="$E $i=$(eval echo "\$$i")"
done

env - $E $SPAWNFCGI -s $FCGISOCKET -f $FCGIPROGRAM -u $USERID -g $GROUPID -C $PHP_FCGI_CHILDREN
chmod 770 $FCGISOCKET
