##
#
# Generated by
#
# LampCP
# https://github.com/jeboehm/LampCP
#
# Licensed under the GPL Version 2 license
# http://www.gnu.org/licenses/gpl-2.0.txt
#
# PLEASE DO NOT CHANGE MANUALLY
# CHANGES WILL BE OVERWRITTEN
#
##

{% for ip in ips %}
    {% if ip.ip != "*" and ip.domain|length > 0 %}
        {% if ip.ipv6 %}
            NameVirtualHost [{{ ip.ip }}]:{{ ip.port }}
        {% else %}
            NameVirtualHost {{ ip.ip }}:{{ ip.port }}
        {% endif %}
    {% endif %}
{% endfor %}

{% for vhost in domains %}
    {% for ip in vhost.ipaddress %}
        {% if ip.hasSsl and vhost.certificate is not null or not ip.hasSsl %}
            {% if ip.ipv6 %}
                <VirtualHost [{{ ip.ip }}]:{{ ip.port }}>
            {% else %}
                <VirtualHost {{ ip.ip }}:{{ ip.port }}>
            {% endif %}

            ServerAdmin {{ vhost.serveradmin }}
            ServerName {{ vhost.servername }}
            ServerAlias {{ vhost.serveralias }}
            SuexecUserGroup {{ vhost.suexecuser }} {{ vhost.suexecgroup }}

            {% if vhost.parsePhp %}
                AddHandler fcgid-script .php
            {% endif %}

            DocumentRoot "{{ vhost.docroot }}"
            DirectoryIndex {{ vhost.directoryindex }}

            {% if ip.hasSsl and vhost.certificate is not null %}
                SSLEngine on
                SSLProtocol all -SSLv2
                SSLCipherSuite ALL:!ADH:!EXPORT:!SSLv2:RC4+RSA:+HIGH:+MEDIUM

                {% if vhost.certificate.CertificateFilePath != "" %}
                    SSLCertificateFile {{ vhost.certificate.CertificateFilePath }}
                {% endif %}

                {% if vhost.certificate.CertificateKeyFilePath != "" %}
                    SSLCertificateKeyFile {{ vhost.certificate.CertificateKeyFilePath }}
                {% endif %}

                {% if vhost.certificate.CertificateChainFilePath != "" %}
                    SSLCertificateChainFile {{ vhost.certificate.CertificateChainFilePath }}
                {% endif %}

                {% if vhost.certificate.CACertificateFilePath != "" %}
                    SSLCACertificateFile {{ vhost.certificate.CACertificateFilePath }}
                {% endif %}

                SetEnvIf User-Agent ".*MSIE.*" nokeepalive ssl-unclean-shutdown
            {% endif %}

            {{ vhost.custom }}

            <Directory "/">
            Options FollowSymLinks
            AllowOverride None
            Order allow,deny
            Deny from all
            </Directory>

            <Directory "{{ vhost.docroot }}">
            Options FollowSymLinks +ExecCGI

            {% if vhost.parsePhp %}
                FCGIWrapper {{ vhost.fcgiwrapper }} .php
            {% endif %}

            Order allow,deny
            Allow from all
            AllowOverride FileInfo Indexes Limit AuthConfig
            </Directory>

            ErrorLog {{ vhost.errorlog }}
            LogLevel warn
            CustomLog {{ vhost.customlog }} combined
            </VirtualHost>
        {% endif %}
    {% endfor %}
{% endfor %}
